# 模块设计

## 模块概览

本项目设计中，包含如下六个模块：

+ UI 模块，位于前端，提供前端展示、与后端通信功能
+ 后端基础模块，位于后端，提供路由、会话管理、异常封装、项目鉴权功能
+ UMS 模块，位于后端，提供用户身份鉴定、用户身份信息管理、项目基本信息管理功能
+ RMS 模块，位于后端，提供项目需求管理、项目服务管理、项目迭代跟踪、项目开发分配功能
+ RDTS 模块，位于后端，依据 Git 的相关记录提供开发细节管理、缺陷跟踪、仓库跟踪功能
+ MySql 数据库模块，即数据库，包含所有表以及表项，提供所有信息的存储功能

## 模块设计细节

### UI 模块

### 后端基础模块

后端基础模块可以解耦合为：

+ 路由模块
+ 会话管理模块
+ 异常封装模块
+ 鉴权模块

#### 路由模块

路由模块处理所收到的 https 请求的路径，从而确定请求所需要访问的模块，将该请求及其信息转交给相应的模块进行细节处理。

#### 会话管理模块

会话管理模块根据前端浏览器的请求进行会话 id 分配，并设置会话的过期时间，将所分配的会话 id 以 Cookie 的形式返还给前端。同时，会话管理模块提供会话的删除、用户会话的绑定功能。

#### 异常封装模块

异常封装模块封装六类异常，向其他模块提供服务：

+ AuthenticationFailed，返回码 -4
+ Throttled，返回码 -3
+ PermissionDenied，返回码 -2
+ 参数错误，返回码 -1
+ Failure，返回码 1
+ 其他错误，返回码 -100

#### 鉴权模块

提供装饰器形式和函数形式的鉴权服务功能。


### UMS 模块

UMS 模块可以解耦合为：

+ 用户管理模块
+ 项目基本信息管理模块
+ 邮箱验证模块

#### 用户管理模块

用户管理模块提供用户注册、用户登录、特定项目内用户角色变更管理、用户个人信息管理功能。

#### 项目基本信息管理模块

项目基本信息管理模块提供项目创建修改、项目查询、项目邀请码生成以及验证功能。

#### 邮箱验证模块

邮箱验证模块提供用户多邮箱绑定、用户主邮箱验证绑定、用户依据主邮箱更改密码功能。

### RMS 模块

RMS 模块可解耦合为：

+ Https 请求解析模块
+ 信息查询模块
+ 信息创建修改模块

#### Https 请求解析模块

Https 请求解析模块根据所分配请求的方法来进一步下分请求，将 GET 类请求分配给信息查询模块，将 POST 类请求分配给信息创建修改模块。

#### 信息查询模块

信息查询模块根据查询请求的用户参数进行鉴权，根据所请求的信息类型从数据库中查询对应数据（包含项目需求、项目服务、项目迭代、项目开发），将所查询到的数据封装成接口所要求的的形式发回响应。

#### 信息创建修改模块

信息创建修改模块根据查询请求的用户参数进行鉴权，解析请求参数所对应的数据要求，检查修改内容的合法性，对相关的数据库表项进行修改，并返回成功与否的响应。

### RDTS 模块

RDTS 可以解耦合为：

+ Https 请求解析模块
+ 信息查询模块
+ 信息创建修改模块
+ 爬虫模块

#### Https 请求解析模块

Https 请求解析模块根据所分配请求的方法来进一步下分请求，将 GET 类请求分配给信息查询模块，将 POST 类请求分配给信息创建修改模块。

#### 信息查询模块

信息查询模块根据查询请求的用户参数进行鉴权，根据所请求的信息类型从数据库中查询对应数据（包含开发细节管理、缺陷跟踪、仓库跟踪），将所查询到的数据封装成接口所要求的的形式发回响应。

#### 信息创建修改模块

信息创建修改模块根据查询请求的用户参数进行鉴权，解析请求参数所对应的数据要求，检查修改内容的合法性，对相关的数据库表项进行修改，并返回成功与否的响应。

#### 爬虫模块

爬虫模块从项目对应的仓库当中爬取 Issue、MR、Commit 等相关信息，并将其加工处理成对应形式之后加入到数据库的表中。爬取模块包含定时爬取以及 webhook 触发式爬取两种模式。

### MySql 数据库模块

MySql 数据库模块提供后端所有模型的存储服务，完成各类数据的持久化存储。


## 系统结构相关图示

![系统结构图](https://s2.loli.net/2022/04/27/l5vKwrp7xI1YmEA.png){.img-fluid tag=2 title='系统结构图'}

<center>系统结构图</center>

![序列图](https://s2.loli.net/2022/04/27/bRiw8sMBWLpV2lX.png){.img-fluid tag=2 title="序列图"}

<center>序列图</center>

![数据流向图](https://s2.loli.net/2022/04/27/vqli32QMTsJ4Dko.png){.img-fluid tag=2 title="数据流向图"}

<center>数据流向图</center>
